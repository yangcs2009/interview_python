

# 负载均衡算法及主流算法

[负载均衡算法及手段](https://segmentfault.com/a/1190000004492447#articleHeader12)  
[几种简单的负载均衡算法及其Java代码实现](https://www.cnblogs.com/xrq730/p/5154340.html)

## 负载均衡
**负载平衡（Load balancing）**是一种计算机技术，用来在多个计算机（计算机集群）、网络连接、CPU、磁盘驱动器或其他资源中分配负载，以达到
**最优化资源使用、最大化吞吐率、最小化响应时间、同时避免过载**的目的。 使用带有负载平衡的多个服务器组件，取代单一的组件，可以 **通过冗余提高可靠性**。
负载平衡服务通常是由专用软件和硬件来完成。 主要作用是将大量作业合理地分摊到多个操作单元上进行执行，用于解决互联网架构中的 **高并发和高可用**的问题。

## 负载均衡算法

### 随机（Random）法
基于概率统计的理论，吞吐量越大，随机算法的效果越接近于轮询算法的效果。

### 加权随机（Weight Random）法
根据后端服务器不同的配置和负载情况来配置不同的权重

### 轮询（Round Robin）法

轮询法的优点在于：试图做到请求转移的绝对均衡。

轮询法的缺点在于：为了做到请求转移的绝对均衡，必须付出相当大的代价，因为为了保证当前轮询的位置变量pos修改的互斥性，需要引入重量级的悲观锁synchronized，
这将会导致该段轮询代码的并发吞吐量发生明显的下降。

### 加权轮询（Weight Round Robin）法
不同的服务器可能机器配置和当前系统的负载并不相同，因此它们的抗压能力也不尽相同，给配置高、负载低的机器配置更高的权重，让其处理更多的请求，
而低配置、高负载的机器，则给其分配较低的权重，降低其系统负载。

实现方式：根据权重的大小，将地址重复地增加到服务器地址列表中，权重越大，该服务器每轮所获得的请求数量越多。比如服务器1权重1，服务器2权重2，
服务器3权重3，则顺序为1-2-2-3-3-3-1-2-2-3-3-3- ......

### 源地址哈希（Hash）法
优点：保证了相同客户端IP地址将会被哈希到同一台后端服务器，直到后端服务器列表变更。根据此特性可以在服务消费者与服务提供者之间建立有状态的session会话。

缺点：除非集群中服务器的非常稳定，基本不会上下线，否则一旦有服务器上线、下线，那么通过源地址哈希算法路由到的服务器是服务器上线、下线前路由到的
服务器的概率非常低，如果是session则取不到session，如果是缓存则可能引发"雪崩"

### 最小连接数（Least Connections）法
以后端服务器的视角来观察系统的负载，而非请求发起方来观察。

根据后端服务器当前的连接情况，动态地选取其中当前积压连接数最少的一台服务器来处理当前请求，尽可能地提高后端服务器的利用效率，将负载合理地分流到每一台机器